<!doctype html>
<html>
    <head>
        <title>jspsych-survey-likert plugin example</title>
        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <!-- this plugin requires the jQuery UI library and stylesheet -->
        <!-- these can be loaded from google's servers with the following links -->
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
        <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/black-tie/jquery-ui.min.css" rel="stylesheet" type="text/css"></link>
        <!-- jsPsych -->
        <script src="scripts/jspsych.js"></script>
        <script src="scripts/plugins/jspsych-survey-likert_temp.js"></script>
        <script src="../jsPsych/scripts/plugins/jspsych-text.js"></script>
        <!-- style -->
        <link href="css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>

    <body>
        <div id="jspsych_target"></div>
    <script type="text/javascript">

        // testing query strings. Taken from:
        // /http://stackoverflow.com/questions/2405355/
        // how-to-pass-a-parameter-to-a-javascript-through-a-url-and-display-it-on-a-page/ 
        var GET = {};
        var query = window.location.search.substring(1).split("&");
        for (var i = 0, max = query.length; i < max; i++)
        {
          if (query[i] === "")
            continue;

          var param = query[i].split("=");
          GET[decodeURIComponent(param[0])] = decodeURIComponent(param[1] || "");
        }
        console.log(GET);

        // Messages
        var welcome_message = '<div id="instructions"><p>Welcome to the experiment! Press enter to continue.</p></div>';

        var instructions = '<div id="instructions"><p>You will see either the word "Red" or the word "Blue", or both\
            words at the same time. If the word you see is"Blue", press the key "b". If the word is "Red", press "r".\
            If you see both words simultaneously, press the key correspnding to the word that is more dominate.\
            Please look at the image for at least six seconds before entering your response.</p><p> Press Enter to\
            begin</p>';

        var debrief = '<div id="instructions"><p>You have finished the experiment. Thanks for participating!\
            Press enter to have your data saved.</ip>';


        // defining groups of questions that will go together.
        var q1 = ["How attractive is this face?"];
        var q2 = ["How distinctive is this face?"];
        var q3 = ['How old is this face?'];

        var q4 = ["What gender is this face?"];

        var images = ['img/male_front.png', 'img/male_front.png', 'img/male_front.png',
                      'img/neutral_front.png'];


        // definiting two different response scales that can be used.
        var scale_1 = ["Not attracive", "Somewhat attractive", "Highly attractive"];
        var scale_2 = ["Not distinctive", "Somewhat distinctive", "Very distinctive"];
        var scale_3 = ["20s", "30s", "40s"];
        var scale_4 = ["Male", "Not sure", "Female"];

        console.log(images);
        var likert_block = {
            type: 'survey-likert',
            stimuli: images,
            questions: [q1, q2, q3, q4],
            labels: [[scale_1], [scale_2], [scale_3], [scale_4]], // need one scale for every question on a page
            intervals: [[scale_1.length], [scale_2.length], [scale_3.length], [scale_4.length]] // note the the intervals and labels don't necessarily need to match.
        };

        var welcome_block = {
               type: 'text',
               text: [welcome_message],
               timing_post_trial: 0
            };

        var instruction_block = {
               type: 'text',
               text: [instructions],
               timing_ost_trial: 1500
            };

        // debriefing block shown after experiment.
        var debrief_block = {
             type: "text",
             text: [debrief]
        };


        // launch jspsych experiment
        jsPsych.init({
            display_element: $('#jspsych_target'),
            experiment_structure: [welcome_block, instruction_block, likert_block, debrief_block],
            on_finish: function(data) {
               var filename = "test" + new Date().getTime() + ".csv";
               var filedata = jsPsych.dataAsCSV();
            
               console.log("saving data");
               console.log(filename + " " + filedata);
               $.ajax( {
                  type:'post',
                  cache: false,
                  url: 'save_data.php', // this is the path to the above PHP script
                  data: {filename: filename, filedata: filedata}
               });
             }
        });
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-50563838-1', 'jspsych.org');
      ga('send', 'pageview');
    </script>
    </body>

</html>
